{% extends 'base.html' %}
{% load static %}

{% block content %}

<style>
    @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .animate-up { animation: fadeUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; opacity: 0; }
    .delay-1 { animation-delay: 0.1s; }
    .delay-2 { animation-delay: 0.2s; }
</style>

<section class="section-content padding-y" style="background-color: #fff; min-height: 80vh;">
   <div class="container">
       <div class="row">

           <aside class="col-md-3">
                <style>
                    /* CẬP NHẬT: Body nền trắng */
                    body { background-color: #ffffff !important; }

                    /* Khối Sidebar */
                    .sidebar-widget {
                        background: #fff;
                        border-radius: 20px;
                        /* Tăng độ đậm bóng lên xíu vì nền giờ là màu trắng */
                        box-shadow: 0 5px 25px rgba(0,0,0,0.05);
                        padding: 20px;
                        border: 1px solid #f0f0f0; /* Viền siêu nhạt để tách biệt */
                    }

                    /* Menu Item */
                    .sidebar-menu-item {
                        display: flex; align-items: center;
                        padding: 12px 20px; margin-bottom: 8px;
                        color: #344767; font-weight: 500; font-size: 14px;
                        border-radius: 12px; transition: all 0.3s ease;
                        text-decoration: none !important;
                        border: 1px solid transparent;
                    }
                    .sidebar-menu-item i {
                        width: 24px; margin-right: 10px; font-size: 16px;
                        text-align: center; transition: 0.3s; color: #8392ab;
                    }
                    .sidebar-menu-item:hover {
                        background-color: #f8f9fa; color: #2152ff;
                        transform: translateX(5px);
                    }
                    .sidebar-menu-item:hover i { color: #2152ff; }

                    /* ACTIVE STATE */
                    .sidebar-menu-item.active {
                        background: linear-gradient(135deg, #2152ff 0%, #21d4fd 100%);
                        color: #fff !important;
                        box-shadow: 0 4px 15px rgba(33, 82, 255, 0.3);
                        font-weight: 600;
                    }
                    .sidebar-menu-item.active i { color: #fff !important; }

                    /* Logout Button */
                    .btn-logout-custom {
                        border: 1px solid #ffecec; background: #fff5f5; color: #dc3545;
                        border-radius: 12px; padding: 12px; font-weight: 600;
                        transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px;
                    }
                    .btn-logout-custom:hover {
                        background: #dc3545; color: #fff;
                        box-shadow: 0 4px 10px rgba(220, 53, 69, 0.3);
                    }
                </style>

                <div class="sidebar-widget animate-up delay-1">
                    <div class="text-center mb-4 pb-3 border-bottom">
                        {% if user.userprofile.profile_picture %}
                            <img src="{{ user.userprofile.profile_picture.url }}" class="rounded-circle mb-2" style="width: 70px; height: 70px; object-fit: cover; border: 4px solid #f8f9fa;">
                        {% else %}
                            <div class="rounded-circle mx-auto mb-2 d-flex align-items-center justify-content-center text-primary font-weight-bold" style="width: 70px; height: 70px; background: #e7f1ff; font-size: 24px;">
                                {{ user.first_name|slice:":1" }}
                            </div>
                        {% endif %}
                        <h6 class="font-weight-bold mb-0 mt-2" style="font-size: 16px;">{{ user.first_name }} {{ user.last_name }}</h6>
                        <small class="text-muted">{{ user.email }}</small>
                    </div>

                    <nav class="nav flex-column">
                        <a class="sidebar-menu-item {% if '/accounts/' == request.path %}active{% endif %}" href="{% url 'dashboard' %}">
                            <i class="fas fa-th-large"></i> Dashboard
                        </a>
                        <a class="sidebar-menu-item {% if '/my_orders/' in request.path %}active{% endif %}" href="{% url 'my_orders' %}">
                            <i class="fas fa-shopping-bag"></i> My Orders
                        </a>
                        <a class="sidebar-menu-item {% if '/my_coupons/' in request.path %}active{% endif %}" href="{% url 'my_coupons' %}">
                            <i class="fas fa-ticket-alt"></i> My Coupons
                        </a>
                        <a class="sidebar-menu-item {% if '/return/my-returns/' in request.path or 'returns' in request.path %}active{% endif %}" href="{% url 'returns:my_returns' %}">
                            <i class="fas fa-undo"></i> My Returns
                        </a>
                        <a class="sidebar-menu-item {% if '/edit_profile/' in request.path %}active{% endif %}" href="{% url 'edit_profile' %}">
                            <i class="fas fa-user-edit"></i> Edit Profile
                        </a>
                        <a class="sidebar-menu-item {% if '/change_password/' in request.path %}active{% endif %}" href="{% url 'change_password' %}">
                            <i class="fas fa-lock"></i> Change Password
                        </a>
                    </nav>

                    <br>
                    <a class="btn-logout-custom btn-block" href="{% url 'logout' %}">
                        <i class="fas fa-power-off"></i> Log out
                    </a>
                </div>
           </aside>
           <main class="col-md-9 animate-up delay-2">
               <article class="card border-0" style="border-radius: 20px; box-shadow: 0 5px 25px rgba(0,0,0,0.05); border: 1px solid #f0f0f0;">

                   <header class="card-header bg-white border-bottom-0 pt-4 pl-4" style="border-radius: 20px 20px 0 0;">
                       <h5 class="d-inline-block font-weight-bold text-dark mb-0">
                           <i class="fa fa-undo text-primary mr-2"></i> My Return Requests
                       </h5>
                   </header>

                   <div class="card-body">
                       {% if returns %}
                       <div class="table-responsive">
                           <table class="table table-hover align-items-center">
                               <thead class="bg-light text-uppercase">
                                   <tr class="text-muted small font-weight-bold" style="background-color: #f9fafb;">
                                       <th class="border-0 rounded-left pl-3">Return #</th>
                                       <th class="border-0">Order #</th>
                                       <th class="border-0">Type</th>
                                       <th class="border-0">Status</th>
                                       <th class="border-0">Refund</th>
                                       <th class="border-0">Date</th>
                                       <th class="border-0 rounded-right text-right pr-3">Action</th>
                                   </tr>
                               </thead>
                               <tbody>
                                   {% for return in returns %}
                                   <tr>
                                       <td class="pl-3"><strong class="text-dark">{{ return.return_number }}</strong></td>
                                       <td>#{{ return.order.order_number }}</td>
                                       <td>{{ return.return_type }}</td>
                                       <td>
                                           <span class="badge badge-pill badge-{% if return.status == 'Pending' %}warning{% elif return.status == 'Approved' %}success{% elif return.status == 'Rejected' %}danger{% else %}info{% endif %} px-3 py-2 font-weight-bold" style="font-size: 11px;">
                                               {{ return.status }}
                                           </span>
                                       </td>
                                       <td class="font-weight-bold text-dark">${{ return.refund_amount|floatformat:2 }}</td>
                                       <td>{{ return.created_at|date:"M d, Y" }}</td>
                                       <td class="text-right pr-3">
                                           <a href="{% url 'returns:return_detail' return.return_number %}"
                                              class="btn btn-sm btn-primary rounded-pill px-3 shadow-sm" style="background: #2152ff; border:none;">
                                               View
                                           </a>
                                       </td>
                                   </tr>
                                   {% endfor %}
                               </tbody>
                           </table>
                       </div>
                       {% else %}
                       <div class="text-center py-5">
                           <div class="mb-3">
                               <span class="fa-stack fa-2x">
                                  <i class="fas fa-circle fa-stack-2x" style="color: #f1f3f5;"></i>
                                  <i class="fas fa-undo fa-stack-1x text-muted"></i>
                               </span>
                           </div>
                           <h6 class="text-dark font-weight-bold">No return requests found</h6>
                           <p class="text-muted small mb-4">You haven't made any return requests yet.</p>
                           <a href="{% url 'my_orders' %}" class="btn btn-primary rounded-pill px-4 shadow-sm" style="background: linear-gradient(135deg, #2152ff 0%, #21d4fd 100%); border:none;">
                               View My Orders
                           </a>
                       </div>
                       {% endif %}
                   </div>
               </article>
           </main>
       </div>
   </div>
</section>
{% endblock %}