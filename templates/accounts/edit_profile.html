{% extends 'base.html' %}
{% load static %}

{% block content %}

<style>
    @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .animate-up { animation: fadeUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; opacity: 0; }
    .delay-1 { animation-delay: 0.1s; }
    .delay-2 { animation-delay: 0.2s; }

    /* Tùy chỉnh Input của Django Form */
    /* Lưu ý: CSS này sẽ tác động vào các thẻ input/select mà Django render ra */
    .form-group input, .form-group select, .form-group textarea {
        height: 50px !important;
        border-radius: 12px !important;
        border: 1px solid #e9ecef !important;
        padding-left: 20px !important;
        width: 100%;
        background-color: #fcfcfc;
        transition: all 0.3s;
    }

    /* Riêng input file (Avatar) */
    .form-group input[type="file"] {
        padding-top: 10px; /* Căn chỉnh text trong input file */
        height: auto !important;
    }

    .form-group input:focus, .form-group select:focus {
        background-color: #fff;
        border-color: #2152ff !important;
        box-shadow: 0 4px 15px rgba(33, 82, 255, 0.1) !important;
        outline: none;
    }

    label {
        font-weight: 600;
        font-size: 13px;
        color: #344767;
        margin-bottom: 8px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    /* Avatar Wrapper */
    .profile-img-container {
        position: relative;
        width: 100px;
        height: 100px;
        margin: 0 auto 20px auto;
    }
    .profile-img-display {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 50%;
        border: 4px solid #f8f9fa;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
</style>

<section class="section-content padding-y" style="background-color: #fff; min-height: 80vh;">
    {% include 'includes/alerts.html' %}

    <div class="container">
        <div class="row">

            {% include 'includes/dashboard_sidebar.html' %}

            <main class="col-md-9 animate-up delay-2">

                <article class="card border-0 shadow-sm" style="border-radius: 20px; border: 1px solid #f0f0f0;">

                    <header class="card-header bg-white border-bottom-0 pt-4 pl-4" style="border-radius: 20px 20px 0 0;">
                        <h5 class="d-inline-block font-weight-bold text-dark mb-0">
                            <i class="fas fa-user-edit text-primary mr-2"></i> Edit Profile
                        </h5>
                    </header>

                    <div class="card-body">

                        <form action="{% url 'edit_profile' %}" method="POST" enctype="multipart/form-data">
                            {% csrf_token %}

                            <div class="text-center mb-4">
                                <div class="profile-img-container">
                                    {% if userprofile.profile_picture %}
                                        <img src="{{ userprofile.profile_picture.url }}" alt="Avatar" class="profile-img-display">
                                    {% else %}
                                        <div class="profile-img-display d-flex align-items-center justify-content-center bg-light text-primary font-weight-bold" style="font-size: 30px;">
                                            {{ user.first_name|slice:":1" }}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="form-group d-inline-block text-left" style="max-width: 300px;">
                                    <label class="d-block text-center mb-1 text-muted small">Change Profile Picture</label>
                                    {{ profile_form.profile_picture }}
                                </div>
                            </div>

                            <hr class="mb-4" style="border-top: 1px dashed #e9ecef;">

                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label>First Name</label>
                                    {{ user_form.first_name }}
                                </div>
                                <div class="form-group col-md-6">
                                    <label>Last Name</label>
                                    {{ user_form.last_name }}
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label>Phone Number</label>
                                    {{ user_form.phone_number }}
                                </div>
                                <div class="form-group col-md-6">
                                    <label>Email Address <small class="text-muted">(Read only)</small></label>
                                    <input type="text" value="{{ user.email }}" class="form-control" disabled style="background-color: #e9ecef; cursor: not-allowed;">
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Address Line 1</label>
                                {{ profile_form.address_line_1 }}
                            </div>

                            <div class="form-group">
                                <label>Address Line 2</label>
                                {{ profile_form.address_line_2 }}
                            </div>

                            <div class="form-row">
                                <div class="form-group col-md-4">
                                    <label>City</label>
                                    {{ profile_form.city }}
                                </div>
                                <div class="form-group col-md-4">
                                    <label>State</label>
                                    {{ profile_form.state }}
                                </div>
                                <div class="form-group col-md-4">
                                    <label>Country</label>
                                    {{ profile_form.country }}
                                </div>
                            </div>

                            <div class="form-group mt-3 d-flex justify-content-end align-items-center">
                                <a href="{% url 'dashboard' %}" class="text-muted mr-4 font-weight-600" style="font-size: 14px;">Cancel</a>
                                <input type="submit" value="Save Changes" class="btn btn-primary rounded-pill px-4 py-2 shadow-sm font-weight-bold"
                                       style="background: linear-gradient(135deg, #2152ff 0%, #21d4fd 100%); border:none; min-width: 140px;">
                            </div>

                        </form>
                    </div> </article>
            </main>
        </div> </div> </section>

{% endblock %}