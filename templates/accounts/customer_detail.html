{% extends 'base.html' %}
{% load static %}


{% block content %}
<section class="section-content padding-y bg">
   <div class="container">
       <div class="row">
           <aside class="col-md-3">
               {% include 'includes/admin_sidebar.html' %}

           </aside>


           <main class="col-md-9">
               <!-- Breadcrumb -->
               <nav aria-label="breadcrumb" class="mb-3">
                   <ol class="breadcrumb">
                       <li class="breadcrumb-item"><a href="{% url 'dashboard' %}">Dashboard</a></li>
                       <li class="breadcrumb-item"><a href="{% url 'admin_customer_list' %}">Quản lý khách hàng</a></li>
                       <li class="breadcrumb-item active">Chi tiết khách hàng</li>
                   </ol>
               </nav>


               <!-- Customer Info Card -->
               <article class="card">
                   <header class="card-header bg-primary text-white">
                       <div class="row align-items-center">
                           <div class="col-md-8">
                               <strong><i class="fa fa-user"></i> Chi tiết khách hàng #{{ customer.id }}</strong>
                           </div>
                           <div class="col-md-4 text-right">
                               {% if customer.is_active %}
                                   <span class="badge badge-success">Đang hoạt động</span>
                               {% else %}
                                   <span class="badge badge-danger">Đã khóa</span>
                               {% endif %}
                           </div>
                       </div>
                   </header>
                   <div class="card-body">
                       <div class="row">
                           <!-- Avatar & Actions -->
                           <div class="col-md-3 text-center border-right">
                               {% if profile and profile.profile_picture %}
                                   <img src="{{ profile.profile_picture.url }}"
                                        class="img-fluid rounded-circle mb-3"
                                        style="width: 150px; height: 150px; object-fit: cover; border: 3px solid #007bff;"
                                        alt="Avatar">
                               {% else %}
                                   <img src="{% static 'images/default-avatar.png' %}"
                                        class="img-fluid rounded-circle mb-3"
                                        style="width: 150px; height: 150px; object-fit: cover; border: 3px solid #007bff;"
                                        alt="Avatar">
                               {% endif %}


                               <h5 class="mb-3">{{ customer.first_name }} {{ customer.last_name }}</h5>


                               <!-- Action Buttons -->
                               <div class="mt-3">
                                   {% if is_admin %}
                                       <!-- ADMIN: Khóa/Mở khóa -->
                                       <form method="POST" action="{% url 'toggle_customer_status' customer.id %}" class="mb-2">
                                           {% csrf_token %}
                                           {% if customer.is_active %}
                                               <button type="submit" class="btn btn-warning btn-block"
                                                       onclick="return confirm('Bạn có chắc muốn khóa tài khoản này?')">
                                                   <i class="fa fa-lock"></i> Khóa tài khoản
                                               </button>
                                           {% else %}
                                               <button type="submit" class="btn btn-success btn-block">
                                                   <i class="fa fa-unlock"></i> Mở khóa tài khoản
                                               </button>
                                           {% endif %}
                                       </form>


                                       <!-- ADMIN: Xóa -->
                                       <form method="POST" action="{% url 'delete_customer' customer.id %}">
                                           {% csrf_token %}
                                           <button type="submit" class="btn btn-danger btn-block"
                                                   onclick="return confirm('⚠️ CẢNH BÁO!\n\nBạn có chắc chắn muốn XÓA VĨNH VIỄN tài khoản này?\n\nEmail: {{ customer.email }}\n\nHành động này KHÔNG THỂ HOÀN TÁC!')">
                                               <i class="fa fa-trash"></i> Xóa tài khoản
                                           </button>
                                       </form>
                                   {% else %}
                                       <!-- STAFF: Chỉ xem -->
                                       <div class="alert alert-info text-center p-2">
                                           <i class="fa fa-info-circle"></i><br>
                                           <small>Bạn chỉ có quyền xem</small>
                                       </div>
                                   {% endif %}


                                   <!-- Gửi Email -->
                                   <a href="mailto:{{ customer.email }}" class="btn btn-info btn-block mt-2">
                                       <i class="fa fa-envelope"></i> Gửi Email
                                   </a>
                               </div>
                           </div>


                           <!-- Customer Details -->
                           <div class="col-md-9">
                               <h4 class="mb-4"><i class="fa fa-id-card"></i> Thông tin tài khoản</h4>


                               <div class="row">
                                   <div class="col-md-6">
                                       <table class="table table-borderless">
                                           <tr>
                                               <td width="150"><strong>Họ:</strong></td>
                                               <td>{{ customer.first_name }}</td>
                                           </tr>
                                           <tr>
                                               <td><strong>Tên:</strong></td>
                                               <td>{{ customer.last_name }}</td>
                                           </tr>
                                           <tr>
                                               <td><strong>Username:</strong></td>
                                               <td>{{ customer.username }}</td>
                                           </tr>
                                           <tr>
                                               <td><strong>Email:</strong></td>
                                               <td>{{ customer.email }}</td>
                                           </tr>
                                           <tr>
                                               <td><strong>Số điện thoại:</strong></td>
                                               <td>{{ customer.phone_number|default:"-" }}</td>
                                           </tr>
                                       </table>
                                   </div>


                                   <div class="col-md-6">
                                       <table class="table table-borderless">
                                           <tr>
                                               <td width="150"><strong>Ngày tham gia:</strong></td>
                                               <td>{{ customer.date_joined|date:"d/m/Y H:i" }}</td>
                                           </tr>
                                           <tr>
                                               <td><strong>Đăng nhập gần nhất:</strong></td>
                                               <td>{{ customer.last_login|date:"d/m/Y H:i"|default:"-" }}</td>
                                           </tr>
                                           <tr>
                                               <td><strong>Trạng thái:</strong></td>
                                               <td>
                                                   {% if customer.is_active %}
                                                       <span class="badge badge-success">Đang hoạt động</span>
                                                   {% else %}
                                                       <span class="badge badge-danger">Đã khóa</span>
                                                   {% endif %}
                                               </td>
                                           </tr>
                                       </table>
                                   </div>
                               </div>


                               <hr>


                               {% if profile %}
                               <h4 class="mb-3"><i class="fa fa-map-marker"></i> Thông tin địa chỉ</h4>
                               <div class="row">
                                   <div class="col-md-12">
                                       <table class="table table-borderless">
                                           <tr>
                                               <td width="150"><strong>Địa chỉ dòng 1:</strong></td>
                                               <td>{{ profile.address_line_1|default:"-" }}</td>
                                           </tr>
                                           <tr>
                                               <td><strong>Địa chỉ dòng 2:</strong></td>
                                               <td>{{ profile.address_line_2|default:"-" }}</td>
                                           </tr>
                                           <tr>
                                               <td><strong>Thành phố:</strong></td>
                                               <td>{{ profile.city|default:"-" }}</td>
                                           </tr>
                                           <tr>
                                               <td><strong>Tỉnh/Bang:</strong></td>
                                               <td>{{ profile.state|default:"-" }}</td>
                                           </tr>
                                           <tr>
                                               <td><strong>Quốc gia:</strong></td>
                                               <td>{{ profile.country|default:"-" }}</td>
                                           </tr>
                                       </table>
                                   </div>
                               </div>
                               {% else %}
                               <div class="alert alert-warning">
                                   <i class="fa fa-exclamation-triangle"></i> Khách hàng chưa cập nhật thông tin địa chỉ.
                               </div>
                               {% endif %}

                           </div>
                       </div>
                   </div>
               </article>

           </main>
       </div>
   </div>
</section>
{% endblock %}

